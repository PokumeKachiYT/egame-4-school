[gd_scene load_steps=4 format=2]

[ext_resource path="res://assets/cursor.svg" type="Texture" id=1]
[ext_resource path="res://sprites/circle.svg" type="Texture" id=2]

[sub_resource type="GDScript" id=1]
resource_name = "GlobalScript"
script/source = "extends Node

onready var base_circle: Sprite = $Circle
var tween = Tween.new()
var click_particle = preload('res://assets/ClickParticle.tscn')

func getCurrentCamera2D():
	var viewport = get_viewport()
	if not viewport:
		return null
	var camerasGroupName = \"__cameras_%d\" % viewport.get_viewport_rid().get_id()
	var cameras = get_tree().get_nodes_in_group(camerasGroupName)
	for camera in cameras:
		if camera is Camera2D and camera.current:
			return camera
	return null

func _ready() -> void:
	add_child(tween)

onready var cursor = $Cursor

func _input(event: InputEvent) -> void:
	if not event.is_pressed() and event.as_text() == \"F11\":
		OS.window_fullscreen = !OS.window_fullscreen
	if (event is InputEventMouseButton and event.is_pressed() and event.button_index == BUTTON_LEFT) or (event is InputEventScreenTouch and not event.pressed):
		var pos = event.position + getCurrentCamera2D().global_position - Vector2(960,540)
		
		if event is InputEventMouseButton:
			pos = get_viewport().get_mouse_position() + getCurrentCamera2D().global_position - Vector2(960,540)
		
		var circle = base_circle.duplicate()
		circle.global_position = pos
		tween.interpolate_property(
			circle,'scale',
			Vector2(0,0),circle.scale,
			.5,Tween.TRANS_EXPO,Tween.EASE_OUT
		)
		tween.interpolate_property(
			circle,'modulate:a',
			1,0,
			.5,Tween.TRANS_EXPO,Tween.EASE_OUT
		)
		circle.show()
		tween.start()
		add_child(circle)
		
		for i in range(10):
			var angle = 360.0 * float(i) / 10.0 + rand_range(-10.0,10.0)
			var particle = click_particle.instance()
			particle.angle = angle
			particle.position = pos
			add_child(particle)
		
		get_tree().create_timer(1).connect('timeout',circle,'queue_free')
	return
	if event is InputEventMouseMotion:
		#Input.mouse_mode = Input.MOUSE_MODE_HIDDEN
		#cursor.show()
		if not getCurrentCamera2D():
			return
		cursor.global_position = get_viewport().get_mouse_position() + getCurrentCamera2D().global_position - Vector2(960,540)
	
"

[node name="Global" type="Node"]
script = SubResource( 1 )

[node name="Cursor" type="Sprite" parent="."]
visible = false
scale = Vector2( 0.1, 0.1 )
texture = ExtResource( 1 )

[node name="Circle" type="Sprite" parent="."]
visible = false
scale = Vector2( 0.2, 0.2 )
texture = ExtResource( 2 )
